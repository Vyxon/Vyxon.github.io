<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>iframe {border: 0;width: 100%;height: 300px;}</style>
</head>
<body>
  <center><img src="/patrick.jpg" style="width: 33%; height:33%;"></center>    
  <p><center>How much would you like to bid for the pineapple under the sea? <input name='amount' id='amount' type='number'></center></p>
  <form id="paymentForm">    
    <div id="widget"></div>
    </form>

    <p><center><b>Step 1) Your Payment Token is: </b><input name="payment_source_token" id="payment_source_token" readonly></center></p>

    <script src="https://app-sandbox.paydock.com/v1/widget.umd.js" ></script>
    <script>
        var widget = new paydock.HtmlWidget('#widget', 'eccb894c4b8a5b7a0a331a7da42cb169cc73bbb4');
        widget.onFinishInsert('input[name="payment_source_token"]', 'payment_source');
        widget.setFormElements([
            {
                field:  'card_name*',
                label: 'Card Holder Name',
                value: 'Damo',
            },
            {
                field:  'card_number*',
                label: 'Card Number',
                value: '4111111111111111',
            }
        ])
        widget.load();
        widget.on('finish', function (data) {
          console.log(data);
          var myHeaders = new Headers();
          myHeaders.append("x-user-secret-key", "6963a6e97c1d0e522ad5d9c2ddcc52319ffb28dc");
          myHeaders.append("Content-Type", "application/json");

          var raw = JSON.stringify({
            "amount": document.getElementById('amount').value,
            "currency": "AUD",
            "description": "test2",
            "token": document.getElementById('payment_source_token').value,
          });

          console.log(raw);

          var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
          };

          fetch("https://api-sandbox.paydock.com/v1/charges", requestOptions)
            .then(response => response.text())
            .then(result => console.log(result))
            .catch(error => console.log('error', error));

        });  
    </script>
    
</body>
</html>